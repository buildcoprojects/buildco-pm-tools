// BuildCo Scope of Works Generator - Data Module

// Trade-specific data
const TradeData = {
    // Trade-specific scope content
    tradeScopes: {
        electrical: `ELECTRICAL SERVICES SCOPE OF WORKS

2. TRADE SPECIFIC SCOPE
   Item    Task
   2.1     The subcontractor has allowed to complete a detailed electrical safety survey prior to the commencement of works. Documentation is to be provided in accordance with the Build Co PMP and to the satisfaction the Build Co Site Management and WHS teams.
   
   2.2     The subcontractor has allowed to complete the comprehensive make-safe and disconnection of all electrical services prior to the commencement of works and as required to facilitate the completion of all demolition and relocation works.
   
   2.3     The subcontractor has allowed for the supply, installation and maintenance of temporary power and lighting as required for the duration of works.
   
   2.4     The subcontractor has allowed to complete the testing and tagging of all Build Co equipment and tools for the duration of works.
   
   2.5     The subcontractor has allowed for the supply and installation of temporary and permanent fixings to facilitate the installation of light fittings and other equipment/specialist items as included in the electrical services package.
   
   2.6     The subcontractor has allowed for the cut-out of all plasterboard, feature and grid/tile ceilings as required to facilitate the installation of all light fittings, other equipment and specialist items as included in the electrical services package.
   
   2.7     The subcontractor has allowed to coordinate with the partitions, ceilings, flooring and joinery contractors to ensure all cable reticulation and pathways can be suitably installed within the built environment.
   
   2.8     The subcontractor has allowed to complete all core drilling and penetrations throughout all structural elements as may be required to complete the works.`,
        
        joinery: `JOINERY SCOPE OF WORKS

2. TRADE SPECIFIC SCOPE
   Item    Task
   2.1     The subcontractor has allowed to complete the comprehensive/detailed set-out of all joinery, for review and approval prior to the commencement of works.
   
   2.2     The subcontractor has allowed to coordinate the completion of works with all services trades, partitions, architectural finishes, etc to ensure set-out and final locations are resolved and achieve the required design intent.
   
   2.3     The subcontractor has allowed to supply detailed shop drawings for all joinery units including revision as necessary to facilitate approval and agreement of all construction details to the satisfaction of the Build Co design team ahead of fabrication.
   
   2.4     The subcontractor has allowed to fabricate all joinery units and associated components in such a way that they can be safely transported to final installation locations across floors via the building loading dock and goods lift.
   
   2.5     The subcontractor has allowed to install all temporary and permanent fixings as required to facilitate the completion of works.
   
   2.6     The subcontractor has allowed to confirm all required support measures within walls are adequate with the partitions contractor and familiarise themselves with required fixings prior to fabrication.
   
   2.7     The subcontractor has allowed to supply, install and maintain suitable protection to all joinery units following installation to ensure no damage is sustained throughout the remainder of the construction period.
   
   2.8     The subcontractor has allowed to provide a comprehensive finishes board providing samples of all finishes and components scheduled for installation in the joinery package.
   
   2.9     The subcontractor has allowed to supply and install all specified FF&E items as associated with the joinery package including but not limited to all specified, hinges, handles, guides, bins, paper towel dispensers, closing mechanisms, etc.
   
   2.10    The subcontractor has allowed to caulk all joinery units where required to ceilings, non-carpeted floor finishes, etc.
   
   2.11    The subcontractor has allowed to caulk all joinery units where required to ceilings, non-carpeted floor finishes, etc.
   
   2.12    The subcontractor has allowed to cut-out tops and joinery units as required to facilitate the installation of services items including but not limited to LED lighting, cable reticulation, sinks & tapware, dishwashers, etc.`,
        
        workstations: `WORKSTATIONS SCOPE OF WORKS

2. TRADE SPECIFIC SCOPE
   Item    Task
   2.1     The subcontractor has allowed to complete the comprehensive/detailed set-out of all workstations and shelving units for review and approval prior to the commencement of works.
   
   2.2     The subcontractor has allowed to coordinate the completion of works with all services trades, partitions, architectural finishes, etc to ensure set-out and final locations are resolved and achieve the required design intent.
   
   2.3     The subcontractor has allowed to supply detailed shop drawings for all workstations and shelving units including revision as necessary to facilitate approval and agreement of all construction details to the satisfaction of the Build Co design team ahead of fabrication.
   
   2.4     The subcontractor has allowed to fabricate all workstations and associated components in such a way that they can be safely transported to final installation locations across floors via the building loading dock and goods lift.
   
   2.5     The subcontractor has allowed to install all temporary and permanent fixings as required to facilitate the completion of works.
   
   2.6     The subcontractor has allowed to confirm all required support measures within walls are adequate with the partitions contractor and familiarise themselves with required fixings prior to fabrication.
   
   2.7     The subcontractor has allowed to supply, install and maintain suitable protection to all workstations following installation to ensure no damage is sustained throughout the remainder of the construction period.
   
   2.8     The subcontractor has allowed to provide a comprehensive finishes board providing samples of all finishes and components scheduled for installation in the joinery package.
   
   2.9     The subcontractor has allowed to supply and install all specified FF&E items as associated with the workstations package including but not limited to all umbilicals, cable management systems, screens, trays, etc.`,
        
        demolition: `DEMOLITION SCOPE OF WORKS

2. TRADE SPECIFIC SCOPE
   Item    Task
   2.1     The subcontractor has allowed to complete daily site cleaning following the completion of demolition works ensuring that all waste is appropriately stacked and placed if not removed from site.
   
   2.2     The subcontractor has allowed for the provision of clean bins, trolleys and all other materials handling equipment to facilitate the transportation of tools, equipment and waste to and from site.
   
   2.3     The subcontractor has allowed to complete regular cleaning of materials handlings pathways. Marked egress pathways are always to be kept clear and free from materials/demolition waste.
   
   2.4     The subcontractor has allowed for the comprehensive cleaning of the loading dock and goods lift as required to the satisfaction of Build Co site management and building management.
   
   2.5     The subcontractor has allowed to complete the comprehensive set-out and identification of all elements scheduled for demolition. Extent is to be reviewed and approved by the Build Co Site Manager prior to commencement.
   
   2.6     The subcontractor has allowed to supply, install and maintain protection to elements/features to be maintained that are immediately adjacent or at risk of damage during demolition including materials handling pathways and access through occupied tenancy/basebuilding areas.
   
   2.7     The subcontractor has allowed to coordinate with all services trades prior to the commencement of demolition to ensure all isolations, disconnections and makesafe are complete.
   
   2.8     The subcontractor has allowed to complete all disruptive and noisy works outside of regular hours (jack hammering, drilling, destructive demolition, etc).
   
   2.9     The subcontractor has allowed to complete all loading during normal hours including temporary storage of materials where waste cannot be immediately removed from site after hours.`,
        
        painting: `PAINTING SCOPE OF WORKS

2. TRADE SPECIFIC SCOPE
   Item    Task
   2.1     The subcontractor has allowed to utilise clean drop sheets at all times where required to avoid paint spill throughout the duration of works.
   
   2.2     The subcontractor has allowed to tape and protect all adjacent surfaces to facilitate the completion of works including aluminium framing, skirting, joinery, etc.
   
   2.3     The subcontractor acknowledges that no paint brushes or trays are to be cleaned on site.
   
   2.4     The subcontractor has allowed to provide all MSDS and suitable storage for all paint finishes, adhesives, etc as specified for installation on the project.
   
   2.5     The subcontractor has allowed to complete all paint application deemed noxious or odour inducing outside of normal hours.
   
   2.6     The subcontractor has allowed to seal coat all plasterboard walls and complete a comprehensive review to identify any imperfections or defects prior to application of finish coats. Where pre-existing defects or imperfections are identified the subcontractor assumes all responsibility to re-apply paint finishes if required.
   
   2.7     The subcontractor has allowed for early attendance to apply paint finishes to all shadow lines, sides (incl top and bottom) of doors and any other elements that may become difficult to paint after final installation.`,
        
        fire: `FIRE SERVICES SCOPE OF WORKS

2. TRADE SPECIFIC SCOPE
   Item    Task
   2.1     The subcontractor has allowed to complete the comprehensive isolation of fire detection and suppression systems in accordance with base building guidelines for the duration of works including isolation of smoke detectors, draindown of sprinkler systems, etc.
   
   2.2     The subcontractor has allowed to install dust caps to all smoke detection to be maintained throughout construction.
   
   2.3     The subcontractor has allowed to complete all necessary fire impairment notices in accordance with base building requirements and the tenancy fit-out guidelines.
   
   2.4     The subcontractor has allowed to provide sleeves and bins for the purpose of collecting waste water from all sprinkler heads and pipework. No waste water is to be disposed to drainage on site.
   
   2.5     The subcontractor has allowed for the supply and installation of temporary and permanent fixings to facilitate the installation of fixtures, fittings and other equipment/specialist items as included in the fire services package.
   
   2.6     The subcontractor has allowed for the cut-out of all plasterboard, feature and grid/tile ceilings as required to facilitate the installation of all fire services, other equipment and specialist items as included in the drawings, specifications and finishes schedule.
   
   2.7     The subcontractor has allowed to complete all core drilling and penetrations throughout all structural elements as may be required to complete the works.
   
   2.8     The subcontractor has allowed for the final coordination and set-out of all fire services fixtures and fittings within ceilings, joinery and feature finishes with the applicable trades and the Build Co Design team.`,
        
        security: `SECURITY SERVICES SCOPE OF WORKS

2. TRADE SPECIFIC SCOPE
   Item    Task
   2.1     The subcontractor has allowed to make-safe, disconnect, remove, protect and store all existing security services equipment prior to the commencement of demolition works (extent to be confirmed and agreed with Build Co site management team upon commencement).
   
   2.2     The subcontractor has allowed for all associated programming to head end equipment as required to facilitate the completion of works.
   
   2.3     The subcontractor has allowed for the cut-out of all doors and door frames to accommodate security services equipment including electric mortices, electric strikes, etc.
   
   2.4     The subcontractor has allowed for the supply and installation of temporary and permanent fixings to facilitate the installation of all security services fittings and equipment.
   
   2.5     The subcontractor has allowed to co-ordinate with the partitions, ceilings, flooring and joinery contractors to ensure all cable reticulation and pathways can be suitable installed with the built environment.
   
   2.6     The subcontractor has allowed for the cut-out of all plasterboard, feature and grid/tile ceilings as required to facilitate the installation of all security equipment and fittings.
   
   2.7     The subcontractor has allowed to complete all core drilling and penetrations as may be required to complete the works including fire sealing around newly installed services to maintain applicable fire rating.
   
   2.8     The subcontractor has allowed to complete all underslung cabling works outside of regular hours. Drop sheets and suitable protection ae to be supplied, installed and maintained by the subcontractor when completing works in adjacent occupied tenancies and a comprehensive clean completed prior to completion.
   
   2.9     The subcontractor has allowed for the final coordination and set-out of all security services fittings and equipment within joinery and feature finishes with the applicable trades and the Build Co Design team.`,
        
        mechanical: `MECHANICAL SERVICES SCOPE OF WORKS

2. TRADE SPECIFIC SCOPE
   Item    Task
   2.1     The subcontractor has allowed to complete comprehensive pre-reads and pre-commissioning prior to commencement including measurement of all air flow, water flow rates, fresh air levels, etc providing all information in a printed report to the satisfaction of the schedules, specifications, Build Co and building management requirements.
   
   2.2     The subcontractor has allowed to complete a detailed dilapidation report of all existing mechanical services (including controls & thermostats) to be provided to Build Co and building management prior to commencement. Where inactive or faulty equipment is detected, or discrepancies exist with the as-built information this is to be flagged immediately.
   
   2.3     The subcontractor has allowed for the removal and protection of all thermostats and controls where required to facilitate the completion of demolition works and subsequent partition/joinery installation.
   
   2.4     The subcontractor has allowed to comply with the tenancy fit-out guidelines with regards to relocation, and re-programming of new and existing controls.
   
   2.5     The subcontractor has allowed for the supply, installation, maintenance and removal upon completion of filter media to all return air grilles and outlets prior to commencement.
   
   2.6     The subcontractor has allowed for the supply and installation of temporary and permanent fixings to facilitate the installation of all diffusers, grilles, exhaust fans, and other equipment/specialist items as included in the mechanical services package.
   
   2.7     The subcontractor has allowed for the cut-out of all plasterboard, feature and grid/tile ceilings as required to facilitate the installation of all mechanical services fittings, diffusers, grilles, fans, other equipment and specialist items as included in the mechanical services package.
   
   2.8     The subcontractor has allowed to coordinate with the partitions, ceilings, flooring and joinery contractors to ensure all duct pathways and mechanical fittings can be suitably installed within the built environment.
   
   2.9     The subcontractor has allowed to complete all core drilling and penetrations throughout all structural elements as may be required to complete the works.
   
   2.10    The subcontractor has allowed for the final coordination and set-out of all mechanical diffusers, grilles, and air pathways within joinery and feature finishes with the applicable trades and the Build Co Design team.
   
   2.11    The subcontractor has allowed to provide comprehensive as-built documentation upon completion of works.
   
   2.12    The subcontractor has allowed to provide all applicable certification prior to the completion of works to the satisfaction of the Building Surveyor.`,
        
        floor: `FLOOR FINISHES SCOPE OF WORKS

2. TRADE SPECIFIC SCOPE
   Item    Task
   2.1     The subcontractor has allowed to complete the comprehensive/detailed set-out of all floor finishes for review and approval prior to the commencement of works.
   
   2.2     The subcontractor has allowed for the supply and install of all trims and/or transition strips in areas where different floor finishes (new and existing) meet.
   
   2.3     The subcontractor has allowed to conduct a detailed inspection of all substrates prior to installing new floor finishes to identify defects, indentations, cracking, holes, etc. Defects identified are to be flagged and communicated with the Build Co site management team prior to installation of finishes.
   
   2.4     The subcontractor has allowed to vacuum and sweep all substrates prior to the installation of floor finishes to remove all debris, etc.
   
   2.5     The subcontractor has allowed to install suitable levelling/ramping to all floor junctions (new and existing) where finished levels differ.
   
   2.6     The subcontractor has allowed for the supply and installation of all underlays as per all relevant drawings, specifications and/or suppliers recommendation/install guidelines as applicable.
   
   2.7     The subcontractor has allowed to install new floor finishes under existing moduline skirting, joinery and other built environment where gaps exist.
   
   2.8     The subcontractor has allowed to provide samples of all floor finishes for review and approval prior to procurement.`,
        
        hydraulics: `HYDRAULICS SCOPE OF WORKS

2. TRADE SPECIFIC SCOPE
   Item    Task
   2.1     The subcontractor has allowed for the disconnection, cap-off and makesafe of all hydraulics and plumbing equipment, fixtures and fittings on all levels prior to the completion of demolition works.
   
   2.2     The subcontractor has allowed for the removal of all redundant waste and supply water pipework to the nearest stack, riser or supply loop.
   
   2.3     The subcontractor has allowed for the supply and installation of acoustic lagging to all pipework within ceiling spaces.
   
   2.4     The subcontractor has allowed to complete all works within adjacent tenancies after hours at the discretion of Build Co and building management.
   
   2.5     The subcontractor has allowed to provide clean drop sheets to cover the full extent of the works area where working in occupied areas.
   
   2.6     The subcontractor has allowed to complete comprehensive trade cleaning and to reinstate ceiling tiles and access panels following the completion of works within adjacent works areas.
   
   2.7     The subcontractor has allowed to provide a detailed procurement schedule and order confirmations for all fixtures, fittings and equipment 48hrs within receiving the contract documentation.
   
   2.8     The subcontractor has allowed to provide all MSDS for all adhesives to be utilised through the project.
   
   2.9     The subcontractor has allowed to comply with all Build Co and building management requirements with regards to hot works, complying with all notice periods and completion of permit applications as applicable.
   
   2.10    The subcontractor has allowed for the cut-out of all penetrations as required to facilitate the completion of hydraulic works including fire and acoustic sealing where through fire rated elements.
   
   2.11    The subcontractor has allowed to complete slab scanning and provision of all corresponding reports for approval prior to cutting any penetrations through structural elements.`
    },
    
    // Default site conditions
    defaultSiteConditions: `STANDARD SITE CONDITIONS

1. SITE ACCESS AND WORKING HOURS
   1.1 Standard working hours are 7:00am to 5:00pm Monday to Friday
   1.2 Weekend work must be approved in advance
   1.3 Site induction is mandatory for all workers
   1.4 Parking is available at [specified location]
   1.5 Deliveries must be coordinated with site manager

2. SAFETY REQUIREMENTS
   2.1 All workers must comply with Build Co Projects' WHS Policies
   2.2 PPE is mandatory - minimum requirements include hard hat, safety boots, hi-vis
   2.3 SWMS must be submitted and approved before work commences
   2.4 Daily pre-start meetings attendance is mandatory
   2.5 All incidents must be reported immediately

3. SITE AMENITIES AND SERVICES
   3.1 Temporary power and water will be provided at designated locations
   3.2 Toilet facilities are provided by the main contractor
   3.3 Subcontractors must provide their own secure storage
   3.4 Waste management - subcontractors must remove their own waste daily
   3.5 A designated smoking area is located [specify location]

4. QUALITY CONTROL
   4.1 Regular inspections will be conducted by Build Co site management
   4.2 Hold points as identified in the contract must be observed
   4.3 Non-conforming work must be rectified at the subcontractor's expense
   4.4 As-built documentation to be provided upon completion
   4.5 Warranties and certificates to be provided as specified`
};

// Local storage handling
const StorageHandler = {
    // Save form data to local storage
    saveFormToLocalStorage: function() {
        const formData = {
            projectName: document.getElementById('project-name').value,
            projectNumber: document.getElementById('project-number').value,
            subcontractorName: document.getElementById('subcontractor-name').value,
            date: document.getElementById('date').value,
            tradeSelect: document.getElementById('trade-select').value,
            customTrade: document.getElementById('custom-trade').value,
            scopeOfWorks: document.getElementById('scope-of-works').value,
            siteConditions: document.getElementById('site-conditions-content').value,
            scheduleItems: TableHandler.getTableData(),
            timestamp: new Date().toISOString()
        };
        
        localStorage.setItem('buildCo_formData', JSON.stringify(formData));
        
        // Show auto-save notification
        const notification = document.getElementById('auto-save-notification');
        notification.innerHTML = `<i class="fas fa-save"></i> Draft saved at ${new Date().toLocaleTimeString()}`;
        notification.classList.add('visible');
        
        setTimeout(() => {
            notification.classList.remove('visible');
        }, 3000);
    },
    
    // Load form data from local storage
    loadFormFromLocalStorage: function() {
        const savedData = localStorage.getItem('buildCo_formData');
        
        if (savedData) {
            try {
                const formData = JSON.parse(savedData);
                
                // Populate form fields
                document.getElementById('project-name').value = formData.projectName || '';
                document.getElementById('project-number').value = formData.projectNumber || '';
                document.getElementById('subcontractor-name').value = formData.subcontractorName || '';
                document.getElementById('date').value = formData.date || '';
                document.getElementById('trade-select').value = formData.tradeSelect || '';
                document.getElementById('custom-trade').value = formData.customTrade || '';
                
                // Handle custom trade display
                if (formData.tradeSelect === 'custom') {
                    document.getElementById('custom-trade-row').style.display = 'flex';
                }
                
                // Set scope of works
                document.getElementById('scope-of-works').value = formData.scopeOfWorks || '';
                
                // Set site conditions
                document.getElementById('site-conditions-content').value = formData.siteConditions || TradeData.defaultSiteConditions;
                
                // Populate schedule items
                if (formData.scheduleItems && formData.scheduleItems.length > 0) {
                    TableHandler.populateTable(formData.scheduleItems);
                }
                
                // Show resume notification
                this.showResumeNotification(formData.timestamp);
                
                // Update character counter
                if (typeof UIComponents !== 'undefined') {
                    UIComponents.updateCharCounter();
                    UIComponents.updateProgressBar();
                }
            } catch (error) {
                console.error('Error loading saved form data:', error);
            }
        } else {
            // Set default values
            document.getElementById('date').valueAsDate = new Date();
            document.getElementById('site-conditions-content').value = TradeData.defaultSiteConditions;
        }
    },
    
    // Show resume notification
    showResumeNotification: function(timestamp) {
        if (!timestamp) return;
        
        // Format date for display
        const date = new Date(timestamp);
        const formattedDate = `${date.toLocaleDateString()} at ${date.toLocaleTimeString()}`;
        
        // Create notification element
        const notification = document.createElement('div');
        notification.className = 'resume-notification';
        notification.innerHTML = `
            <div class="notification-content">
                <i class="fas fa-info-circle"></i>
                <div>
                    <p>You are viewing a saved draft from ${formattedDate}</p>
                    <div class="notification-actions">
                        <button id="btn-continue" class="btn btn-sm btn-primary">Continue Editing</button>
                        <button id="btn-clear" class="btn btn-sm btn-secondary">Start New Form</button>
                    </div>
                </div>
                <button class="btn-close" aria-label="Close notification">&times;</button>
            </div>
        `;
        
        // Insert at the top of the main content
        const main = document.getElementById('main-content');
        main.insertBefore(notification, main.firstChild);
        
        // Add event listeners
        notification.querySelector('#btn-continue').addEventListener('click', function() {
            notification.remove();
        });
        
        notification.querySelector('#btn-clear').addEventListener('click', function() {
            localStorage.removeItem('buildCo_formData');
            location.reload();
        });
        
        notification.querySelector('.btn-close').addEventListener('click', function() {
            notification.remove();
        });
    },
    
    // Set up auto-save functionality
    setupAutoSave: function() {
        // Save on input changes
        const inputs = document.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            input.addEventListener('change', Utilities.debounce(() => {
                this.saveFormToLocalStorage();
            }, 500));
        });
        
        // Also save every 2 minutes
        setInterval(this.saveFormToLocalStorage.bind(this), 120000);
    }
};
